(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{KD:()=>I,p_:()=>h,vs:()=>v});var t=fetch("https://nomoreparties.co/v1/wff-cohort-36/users/me",{headers:{authorization:"4b69a0c0-a05b-4d1b-831f-c7aa3eb401d3",method:"GET"}}),o=fetch("https://nomoreparties.co/v1/wff-cohort-36/cards",{headers:{authorization:"4b69a0c0-a05b-4d1b-831f-c7aa3eb401d3",method:"GET"}});function n(e,t,o,n,r){var a=t.content.querySelector(".places__item").cloneNode(!0),c=a.querySelector(".card__image");c.classList.add("popup-btn");var i=a.querySelector(".card__title"),u=a.querySelector(".card__delete-button"),s=a.querySelector(".card__like-button"),l=a.querySelector(".card__like-count");l.textContent=e.likes.length,e.likes.some((function(t){return t._id===e.myId}))&&s.classList.add("card__like-button_is-active"),u.addEventListener("click",(function(t){var n;t.stopPropagation(),o(a),n=e._id,fetch("https://nomoreparties.co/v1/wff-cohort-36/cards/".concat(n),{method:"DELETE",headers:{authorization:"4b69a0c0-a05b-4d1b-831f-c7aa3eb401d3","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))})),e.isMyCard||u.remove(),s.addEventListener("click",(function(t){Array.from(t.target.classList).includes("card__like-button_is-active")?function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-36/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"4b69a0c0-a05b-4d1b-831f-c7aa3eb401d3","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log(e);var o=e.likes.length;t.textContent=o}))}(e._id,l):function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-36/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"4b69a0c0-a05b-4d1b-831f-c7aa3eb401d3","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){var o=e.likes.length;t.textContent=o}))}(e._id,l),n(t)})),c.addEventListener("click",r);var d=e.name,p=e.link;return c.src=p,c.alt=e.name,c.setAttribute("loading","lazy"),i.textContent=d,a}function r(e,t){e.remove()}function a(e){e.target.classList.toggle("card__like-button_is-active")}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keyup",u)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",u)}function u(e){e.stopPropagation(),"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}var s,l,d,p,f,m,_,h=document.querySelector(".places__list"),v=document.querySelector("#card-template"),y=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),S=document.querySelector(".profile__image"),g=document.querySelector("[name=edit-profile]"),C=document.querySelector("[name=new-place]"),k=document.querySelector("[name=update-avatar]"),q=document.querySelector("[name=place-name]"),E=document.querySelector("[name=link]"),L=document.querySelector("[name=profile-avatar]"),x=document.querySelector(".popup_type_edit"),j=document.querySelector(".popup_type_new-card"),P=document.querySelector(".popup_type_image"),w=document.querySelector(".popup_type_update-avatar"),T=(j.querySelector(".popup__button"),w.querySelector(".popup__button")),A=(x.querySelector(".popup__button"),P.querySelector(".popup__image")),z=P.querySelector(".popup__caption"),O=document.querySelector(".profile__edit-button"),D=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__image");function I(e){A.src=e.target.src,A.alt=e.target.alt,z.textContent=e.target.alt,c(P)}[x,j,P,w].forEach((function(e){e.addEventListener("click",(function(t){t.stopPropagation();var o,n=Array.from(t.target.classList);(n.includes("popup_is-opened")||n.includes("popup__close"))&&(i(t.currentTarget),o=e,Array.from(o.querySelectorAll(".error-element")).forEach((function(e){e.textContent=""})))}))})),O.addEventListener("click",(function(e){e.stopPropagation(),g.name.value=y.textContent,g.description.value=b.textContent,c(x)})),D.addEventListener("click",(function(e){e.stopPropagation(),c(j)})),B.addEventListener("click",(function(e){e.stopPropagation(),c(w)})),g.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.name.value,o=e.target.description.value;y.textContent=t,b.textContent=o,function(e,t,o){o.textContent="Сохранение...",fetch("https://nomoreparties.co/v1/wff-cohort-36/users/me",{method:"PATCH",headers:{authorization:"4b69a0c0-a05b-4d1b-831f-c7aa3eb401d3","Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){o.textContent="Сохранено"})).catch((function(e){console.log(e)}))}(t,o,O),i(x)})),C.addEventListener("submit",(function(e){e.preventDefault();var t=q.value,o=E.value;e.target.reset(),i(j),function(e,t,o){o.textContent="Сохранение...",fetch("https://nomoreparties.co/v1/wff-cohort-36/cards",{method:"POST",headers:{authorization:"4b69a0c0-a05b-4d1b-831f-c7aa3eb401d3","Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(c){o.textContent="Сохранить";var i=n({name:e,link:t,likes:[],isMyCard:!0,_id:c._id,myId:c.owner._id},v,r,a,I);h.insertBefore(i,h.firstChild)})).catch((function(e){console.log(e)}))}(t,o,D)})),k.addEventListener("submit",(function(e){var t,o,n;e.preventDefault(),t=L.value,o=S,(n=T).textContent="Сохранение...",fetch("https://nomoreparties.co/v1/wff-cohort-36/users/me/avatar",{method:"PATCH",headers:{authorization:"4b69a0c0-a05b-4d1b-831f-c7aa3eb401d3","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.json()})).then((function(e){n.textContent="Сохранение",o.style.backgroundImage="url(".concat(t,")")})),i(w)})),l=(s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}).formSelector,d=s.inputSelector,p=s.inputErrorClass,f=s.errorClass,m=s.submitButtonSelector,_=s.inactiveButtonClass,Array.from(document.querySelectorAll(l)).forEach((function(e){!function(e,t,o,n,r,a){var c=Array.from(e.querySelectorAll(t)),i=e.querySelector(r);console.log(i),c.forEach((function(t){t.addEventListener("input",(function(r){!function(e,t,o,n){t.validity.valid?function(e,t,o,n){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(o),r.textContent="",r.classList.remove(n)}(e,t,o,n):function(e,t,o,n,r){var a=e.querySelector("#".concat(t.id,"-error"));t.classList.add(n),a.textContent=o,a.classList.add(r)}(e,t,t.validationMessage,o,n)}(e,t,o,n),function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o)):(t.disabled=!0,t.classList.add(o))}(c,i,a)}))}))}(e,d,p,f,m,_)})),function(e,n,r,a,c,i,u,s,l){Promise.all([t,o]).then((function(e){if(!e.every((function(e){return e.ok})))throw new Error("Где-то в промисах ошибка");return Promise.all(e.map((function(e){return e.json()})))})).then((function(t){var o=t[0]._id,d=t[0],p=d.name,f=d.about,m=d.avatar;e.textContent=p,n.textContent=f,r.style.backgroundImage="url(".concat(m,")"),console.log(t),t[1].map((function(e){var t=e.name,n=e.link,r=e.likes,a=e.owner,c=e._id;return{name:t,link:n,likes:r,isMyCard:o===a._id,_id:c,myId:o}})).forEach((function(e){a.append(c(e,i,u,s,l))}))})).catch((function(e){console.log(e)}))}(y,b,S,h,n,v,r,a,I)})();